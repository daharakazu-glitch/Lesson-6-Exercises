<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 6 Exercises 関係詞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }
        .control-button:hover {
            transform: scale(1.1);
            transition: transform 0.2s;
        }
        .highlight {
            color: #E53E3E; /* red-600 */
            /* text-decoration: underline; */ /* It's already bold, underline might be too much */
            font-weight: bold;
        }
        .placeholder {
            color: #3B82F6; /* blue-500 */
            font-weight: bold;
        }
        .highlight-exp {
            font-weight: bold;
            text-decoration: underline;
        }
        .explanation-panel, .recognition-panel {
            transition: all 0.3s ease-in-out;
        }
        .recording {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Lesson 6 Exercises</h1>
            <p class="text-gray-600 mt-2">関係詞 練習問題</p>
        </header>

        <main class="space-y-6" id="main-content">
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-blue-500 pl-4 mb-4">1. 空所補充</h2>
                <div id="sentences-1" class="space-y-4"></div>
            </section>
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-green-500 pl-4 mb-4">2. 語句補充</h2>
                <div id="sentences-2" class="space-y-4"></div>
            </section>
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-yellow-500 pl-4 mb-4">3. 適切な語句選択</h2>
                <div id="sentences-3" class="space-y-4"></div>
            </section>
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-purple-500 pl-4 mb-4">4. 語句整序</h2>
                <div id="sentences-4" class="space-y-4"></div>
            </section>
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-red-500 pl-4 mb-4">5. 和文英訳</h2>
                <div id="sentences-5" class="space-y-4"></div>
            </section>
        </main>
    </div>

    <script>
        const sentences = [
            // 1. 空所補充
            { id: 1, category: '1', en: "She talked about a book <span class='highlight'>whose title</span> I can't remember.", jp: "書名を思い出せないが、彼女はある本についての話をした。", explanation: "先行詞 a book を修飾する関係代名詞の所有格 whose を使う。a book's title → whose title。" },
            { id: 2, category: '1', en: "<span class='highlight'>What irritated</span> me most was the way he talked to me.", jp: "私が最もいらいらしたのは、私に対する彼の話し方だった。", explanation: "「～したこと（もの）」を表す関係代名詞 what を使う。What irritated me most が文の主語になる。" },
            { id: 3, category: '1', en: "Alaska is one of the places <span class='highlight'>where I want</span> to go fishing.", jp: "アラスカは、私が釣りに行きたい場所の1つだ。", explanation: "先行詞 a place を修飾する関係副詞 where を使う。in the places → where。" },
            { id: 4, category: '1', en: "<span class='highlight'>Whoever</span> borrows books from the library is required to show a student card.", jp: "その図書館から本を借りる人は誰でも学生証を見せることが求められる。", explanation: "「～する人は誰でも」という意味の複合関係代名詞 Whoever を使う。Anyone who と同じ意味。" },
            { id: 5, category: '1', en: "Sunday is <span class='highlight'>the day when</span> I have the most free time.", jp: "日曜日は、僕の自由な時間がいちばん多い日だ。", explanation: "先行詞 the day を修飾する関係副詞 when を使う。on the day → when。" },
            // 2. 語句補充
            { id: 6, category: '2', en: "Flip lives in a house on Malbone Street, <span class='highlight'>where his grandfather was born</span>.", jp: "フリップは、彼の祖父が生まれたマルボーン通りの家に住んでいる。", explanation: "関係副詞の非制限用法。コンマの後に where を置き、「そしてそこで～」と情報を付け加える。" },
            { id: 7, category: '2', en: "My brother, <span class='highlight'>who lives in</span> Tokyo, works for an IT company.", jp: "兄は東京在住で、IT企業で働いている。", explanation: "関係代名詞の非制限用法。My brother について「東京に住んでいる」という補足説明を加える。" },
            { id: 8, category: '2', en: "He said he had graduated from a college, <span class='highlight'>which was not true</span>.", jp: "彼は大学を卒業したと言ったが、それは本当ではなかった。", explanation: "前の文全体を先行詞とする関係代名詞 which の非制限用法。" },
            { id: 9, category: '2', en: "This is the hospital <span class='highlight'>where my mother works</span>.", jp: "ここは母が働いている病院です。", explanation: "先行詞 the hospital を修飾する関係副詞 where を使う。at which my mother works とも言える。" },
            { id: 10, category: '2', en: "Risa got up late this morning. <span class='highlight'>That's why she was late</span> for school.", jp: "リサは今朝寝坊をしました。だから学校に遅れました。", explanation: "That's why S+V で「そういうわけで～だ」という意味を表す。" },
            // 3. 適切な語句選択
            { id: 11, category: '3', en: "My two uncles, <span class='highlight'>who</span> are twins, run a thrift shop together.", jp: "私の2人のおじは双子で、一緒にリサイクルショップを経営しています。", explanation: "先行詞 My two uncles は人なので、関係代名詞 who を使う。非制限用法。 [what/which/who/that]" },
            { id: 12, category: '3', en: "A large proportion of <span class='highlight'>what</span> the Japanese eat every day is imported from other countries.", jp: "日本人が毎日食べるものの大部分は、他国から輸入されている。", explanation: "「～するもの」という意味で、それ自体が名詞節を作る関係代名詞 what を使う。 [what/which/who/that]" },
            { id: 13, category: '3', en: "When the earthquake struck, the first thing <span class='highlight'>that</span> came to my mind was to turn off the gas.", jp: "地震が起きたとき、最初に頭に浮かんだのはガスを止めることだった。", explanation: "先行詞に the first thing があるので、関係代名詞は that を使うのが一般的。 [what/which/who/that]" },
            { id: 14, category: '3', en: "Many of them thought he was a coward, <span class='highlight'>which</span> he was not.", jp: "彼らの多くは彼を臆病者だと思ったが、実際はそうではなかった。", explanation: "前の文の内容を受ける関係代名詞 which の非制限用法。 [what/which/who/that]" },
            // 4. 語句整序
            { id: 15, category: '4', en: "<span class='highlight'>Everything that happens in this world</span> has a cause and effect.", jp: "この世で起こるすべてのことには、原因と結果がある。", scrambled: "( world / everything / happens / in / that / this )", explanation: "Everything を先行詞とし、関係代名詞 that で修飾する形を作る。" },
            { id: 16, category: '4', en: "I couldn't forgive <span class='highlight'>him for what he had done</span>.", jp: "私は彼のしたことが許せなかった。", scrambled: "( him / what / done / had / for / he )", explanation: "forgive A for B「AをBのことで許す」。Bの部分に関係代名詞 what を使った名詞節を置く。" },
            { id: 17, category: '4', en: "<span class='highlight'>All you have to do is</span> wait for him at the coffee shop.", jp: "あなたは喫茶店で彼を待っているだけでいい。", scrambled: "( all / do / have / is / to / you )", explanation: "All you have to do is (to) do「～しさえすればよい」。動詞の原形 wait が続くことに注意。" },
            { id: 18, category: '4', en: "Ben has two brothers, <span class='highlight'>both of whom now live abroad</span>.", jp: "ベンは2人の兄がいて、今2人とも外国に住んでいる。", scrambled: "( abroad / both / live / of / whom / now )", explanation: "関係代名詞の非制限用法。〈both of whom ...〉で「そしてその両方が～」という意味を表す。" },
            // 5. 和文英訳
            { id: 19, category: '5', en: "Please help yourself to <span class='highlight'>whatever you like</span>.", jp: "何でも好きなものを自由にお取りください。", explanation: "「... するものは何でも」 は複合関係代名詞の whatever で表す。help oneself to~ 「(食べ物)を自分で取って食べる」。" },
            { id: 20, category: '5', en: "Human beings are not the only animal <span class='highlight'>that can use language and tools</span>.", jp: "人間は言語や道具を使うことができる唯一の動物ではない。", explanation: "先行詞に限定語句の the only が付くので、関係代名詞は that にする。" },
            { id: 21, category: '5', en: "The day will soon come <span class='highlight'>when robots will do various kinds of work instead of human beings</span>.", jp: "ロボットが人間の代わりにさまざまな仕事をする時代がまもなく来るだろう。", explanation: "先行詞 day を説明する関係詞節が長いので、先行詞と離して文末に置く。The day will (soon) come when S'+V' 「...する日 [時、時代]が(まもなく)来るだろう」。" },
            { id: 22, category: '5', en: "<span class='highlight'>The reason why everyone comes to like him</span> is that he is very kind and honest.", jp: "誰もが彼を好きになる理由は、彼がとても親切で正直だからである。", explanation: "理由を表す関係代名詞 whyを使って、 the reason why S'+V)とする。日本語では「理由は... だからだ」と述べ るが、英語では because を使わずに接続詞 that を使って 「理由は...ということだ」というSVCの文にする。come to do 「~するようになる」。" },
            { id: 23, category: '5', en: "Only those <span class='highlight'>who had finished the exam</span> could leave the room.", jp: "試験を終えた人だけが部屋を出て行くことができた。", explanation: "ここでの onlyは、「唯一の~」 という意味の形容詞では なく、「だた〜だけ」という意味の副詞。onlyは先行詞 に含まれないので、関係代名詞は that を使う必要はなく、 whoを使う。those who... の代わりに the people who ... を使ってもよい。" }
        ];
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let mediaRecorder;
        let mediaStream;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
        } else {
            console.log("Speech Recognition Not Supported");
        }

        function calculateSimilarity(s1, s2) {
            let longer = s1;
            let shorter = s2;
            if (s1.length < s2.length) {
                longer = s2;
                shorter = s1;
            }
            let longerLength = longer.length;
            if (longerLength === 0) {
                return 1.0;
            }
            return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
        }

        function editDistance(s1, s2) {
            s1 = s1.toLowerCase();
            s2 = s2.toLowerCase();

            const costs = new Array();
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i == 0) {
                        costs[j] = j;
                    } else {
                        if (j > 0) {
                            let newValue = costs[j - 1];
                            if (s1.charAt(i - 1) != s2.charAt(j - 1))
                                newValue = Math.min(Math.min(newValue, lastValue),
                                    costs[j]) + 1;
                            costs[j - 1] = lastValue;
                            lastValue = newValue;
                        }
                    }
                }
                if (i > 0)
                    costs[s2.length] = lastValue;
            }
            return costs[s2.length];
        }


        function handleRecording(sentence, recordButton, resultPanel) {
            if (!recognition) {
                resultPanel.innerHTML = `<p class="text-red-500">お使いのブラウザは音声認識に対応していません。</p>`;
                return;
            }

            if (recordButton.classList.contains('recording')) {
                recognition.stop(); // This will trigger onend, which handles stopping mediaRecorder
                return;
            }
            
            resultPanel.innerHTML = ''; // Clear previous results

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaStream = stream; // Store the stream
                    mediaRecorder = new MediaRecorder(stream);
                    let audioChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        if (audioChunks.length === 0) return;

                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        // Append playback controls if the result panel is already populated
                        if (resultPanel.innerHTML.trim() !== '' && !resultPanel.querySelector('.playback-div')) {
                            const playbackDiv = document.createElement('div');
                            playbackDiv.className = 'playback-div flex items-center space-x-2 mt-3 pt-3 border-t border-gray-200';
                            playbackDiv.innerHTML = `
                                <button class="control-button p-2 rounded-full bg-indigo-500 text-white hover:bg-indigo-600 focus:outline-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                                <p class="text-sm text-gray-600">自分の音声を確認する</p>
                            `;
                            const audioPlayer = new Audio(audioUrl);
                            playbackDiv.querySelector('button').onclick = () => {
                                audioPlayer.play();
                            };
                            
                            resultPanel.appendChild(playbackDiv);
                        }
                        audioChunks = []; // Reset chunks for next recording
                    };

                    recognition.start();

                    recognition.onstart = () => {
                        recordButton.classList.add('recording');
                        recordButton.classList.remove('bg-green-500');
                        recordButton.classList.add('bg-red-500');
                        recordButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10h.01M15 10h.01M9 14h6" /></svg>`; // Stop icon
                        resultPanel.innerHTML = `<p class="text-gray-500">録音中...</p>`;
                        mediaRecorder.start();
                    };

                    recognition.onend = () => {
                        recordButton.classList.remove('recording');
                        recordButton.classList.remove('bg-red-500');
                        recordButton.classList.add('bg-green-500');
                        recordButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v3a3 3 0 01-3 3z" /></svg>`; // Mic icon
                        
                        if (mediaRecorder && mediaRecorder.state === 'recording') {
                            mediaRecorder.stop();
                        }
                        if (mediaStream) {
                            mediaStream.getTracks().forEach(track => track.stop()); // Stop the mic
                        }
                    };

                    recognition.onresult = (event) => {
                        if (!event.results || !event.results[0] || !event.results[0][0] || !event.results[0][0].transcript) {
                            console.warn("Speech recognition result was empty or invalid.");
                            resultPanel.innerHTML = `<p class="text-yellow-600">音声を認識できませんでした。もう一度お試しください。</p>`;
                            return;
                        }

                        const transcript = event.results[0][0].transcript;
                        const cleanOriginal = sentence;
                        const cleanTranscript = transcript.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/\s\s+/g, ' ').trim().toLowerCase();
                        
                        const similarity = calculateSimilarity(cleanOriginal, cleanTranscript);
                        const score = Math.round(similarity * 100);

                        let feedback = '';
                        let colorClass = '';
                        if (score >= 85) {
                            feedback = '素晴らしい！';
                            colorClass = 'text-green-600';
                        } else if (score >= 65) {
                            feedback = '惜しい！';
                            colorClass = 'text-yellow-600';
                        } else {
                            feedback = 'もう一度！';
                            colorClass = 'text-red-600';
                        }
                        
                        const resultDiv = document.createElement('div');
                        resultDiv.innerHTML = `
                            <p class="text-gray-800">あなたの発音: 「${transcript}」</p>
                            <div class="flex items-center mt-2">
                                <p class="font-bold ${colorClass}">${feedback}</p>
                                <p class="ml-4 text-sm text-gray-600">スコア: ${score}点</p>
                            </div>
                        `;
                        // Clear the panel and add the new results
                        resultPanel.innerHTML = '';
                        resultPanel.appendChild(resultDiv);
                    };

                    recognition.onerror = (event) => {
                         resultPanel.innerHTML = `<p class="text-red-500">エラーが発生しました: ${event.error}</p>`;
                         // Ensure everything stops on error
                         if (mediaRecorder && mediaRecorder.state === 'recording') {
                             mediaRecorder.stop();
                         }
                         if (mediaStream) {
                             mediaStream.getTracks().forEach(track => track.stop());
                         }
                    };
                })
                .catch(err => {
                    console.error("getUserMedia error:", err);
                    resultPanel.innerHTML = `<p class="text-red-500">マイクへのアクセス許可が必要です。ブラウザの設定を確認し、ページを再読み込みしてください。</p>`;
                });
        }


        function createSentenceCard(sentence) {
            const card = document.createElement('div');
            card.className = 'bg-white p-4 rounded-lg shadow-md';
            
            const contentAndControls = document.createElement('div');
            contentAndControls.className = 'flex items-start space-x-4';

            const numberDiv = document.createElement('div');
            numberDiv.className = 'flex-shrink-0 bg-gray-200 text-gray-700 font-bold rounded-full h-8 w-8 flex items-center justify-center text-sm';
            numberDiv.textContent = String(sentence.id);

            const textContentDiv = document.createElement('div');
            textContentDiv.className = 'flex-grow';

            const enP = document.createElement('p');
            enP.className = 'text-lg text-gray-800 font-medium';

            const jpP = document.createElement('p');
            jpP.className = 'text-gray-600 mt-1';
            jpP.textContent = sentence.jp;

            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'flex flex-col space-y-2 ml-2';

            const audioButton = document.createElement('button');
            audioButton.className = 'control-button p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none';
            audioButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>`;
            audioButton.onclick = () => {
                if (speechSynthesis.speaking) speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(sentence.en.replace(/<[^>]*>?/gm, ''));
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            };

            const recordButton = document.createElement('button');
            recordButton.className = 'control-button p-2 rounded-full bg-green-500 text-white hover:bg-green-600 focus:outline-none';
            recordButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v3a3 3 0 01-3 3z" /></svg>`;

            const buttonGroup = document.createElement('div');
            buttonGroup.className = 'flex items-center space-x-2';

            const toggleAnswerButton = document.createElement('button');
            toggleAnswerButton.className = 'control-button text-xs px-2 py-1 bg-yellow-400 text-yellow-800 rounded-md hover:bg-yellow-500';
            toggleAnswerButton.textContent = '解答表示';

            const toggleButton = document.createElement('button');
            toggleButton.className = 'control-button text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300';
            toggleButton.textContent = '解説';

            // --- Logic for Toggling Answers ---
            let isAnswerShown = false; // Use a state variable for robust toggling

            if (sentence.category === '5') {
                 // 和文英訳
                enP.innerHTML = sentence.en;
                enP.classList.add('hidden');
                toggleAnswerButton.onclick = () => {
                    isAnswerShown = !isAnswerShown;
                    enP.classList.toggle('hidden');
                    toggleAnswerButton.textContent = isAnswerShown ? '解答非表示' : '解答表示';
                };
            } else if (sentence.category === '4') {
                // 語句整序
                const correctSentenceHTML = sentence.en;
                const scrambledSentenceHTML = sentence.en.replace(/<span class='highlight'>.*?<\/span>/, `<span class='placeholder'>${sentence.scrambled}</span>`);
                enP.innerHTML = scrambledSentenceHTML; // Show scrambled by default
                toggleAnswerButton.onclick = () => {
                    isAnswerShown = !isAnswerShown;
                    if (isAnswerShown) {
                        enP.innerHTML = correctSentenceHTML;
                        toggleAnswerButton.textContent = '解答非表示';
                    } else {
                        enP.innerHTML = scrambledSentenceHTML;
                        toggleAnswerButton.textContent = '解答表示';
                    }
                };
            } else { // Categories '1', '2' & '3'
                const highlightRegex = /<span class='highlight'>(.*?)<\/span>/;
                const parts = sentence.en.split(highlightRegex);
                if (parts.length === 3) {
                    enP.appendChild(document.createTextNode(parts[0]));
                    const highlightSpan = document.createElement('span');
                    highlightSpan.className = 'highlight hidden';
                    highlightSpan.innerHTML = parts[1];
                    const placeholderSpan = document.createElement('span');
                    placeholderSpan.className = 'placeholder';
                    if (sentence.category === '1' || sentence.category === '3') {
                        const wordCount = parts[1].trim().split(/\s+/).filter(Boolean).length;
                        placeholderSpan.textContent = Array(wordCount).fill('( _____ )').join(' ');
                    } else { // category '2'
                        placeholderSpan.textContent = '( ______________ )';
                    }
                    enP.appendChild(highlightSpan);
                    enP.appendChild(placeholderSpan);
                    enP.appendChild(document.createTextNode(parts[2]));
                    toggleAnswerButton.onclick = () => {
                        highlightSpan.classList.toggle('hidden');
                        placeholderSpan.classList.toggle('hidden');
                        isAnswerShown = !isAnswerShown;
                        toggleAnswerButton.textContent = isAnswerShown ? '解答非表示' : '解答表示';
                    };
                } else {
                    enP.innerHTML = sentence.en; // Fallback
                    toggleAnswerButton.style.display = 'none';
                }
            }
            
            textContentDiv.appendChild(enP);
            textContentDiv.appendChild(jpP);
            
            buttonGroup.appendChild(toggleAnswerButton);
            buttonGroup.appendChild(toggleButton);

            controlsDiv.appendChild(audioButton);
            controlsDiv.appendChild(recordButton);
            controlsDiv.appendChild(buttonGroup);
            
            contentAndControls.appendChild(numberDiv);
            contentAndControls.appendChild(textContentDiv);
            contentAndControls.appendChild(controlsDiv);

            const explanationPanel = document.createElement('div');
            explanationPanel.className = 'explanation-panel hidden mt-3 pt-3 border-t border-gray-200';
            explanationPanel.innerHTML = `<p class="text-gray-700 bg-gray-50 p-3 rounded-md">${sentence.explanation}</p>`;
            toggleButton.onclick = () => {
                explanationPanel.classList.toggle('hidden');
            };

            const recognitionPanel = document.createElement('div');
            recognitionPanel.className = 'recognition-panel mt-3 pt-3 border-t border-gray-200';

            recordButton.onclick = () => handleRecording(sentence.en.replace(/<[^>]*>?/gm, ''), recordButton, recognitionPanel);

            card.appendChild(contentAndControls);
            card.appendChild(explanationPanel);
            card.appendChild(recognitionPanel);

            return card;
        }

        function renderSentences() {
            if (!SpeechRecognition) {
                const mainContent = document.getElementById('main-content');
                const warning = document.createElement('div');
                warning.className = 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-md';
                warning.innerHTML = '<p class="font-bold">音声認識機能が利用できません</p><p>お使いのブラウザは音声認識に対応していないか、マイクへのアクセスが許可されていません。発音練習機能を利用するには、Google Chromeなどの対応ブラウザをご利用ください。</p>';
                mainContent.prepend(warning);
            }
            
            const containers = {
                '1': document.getElementById('sentences-1'),
                '2': document.getElementById('sentences-2'),
                '3': document.getElementById('sentences-3'),
                '4': document.getElementById('sentences-4'),
                '5': document.getElementById('sentences-5'),
            };

            sentences.forEach(sentence => {
                const card = createSentenceCard(sentence);
                if (containers[sentence.category]) {
                    containers[sentence.category].appendChild(card);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', renderSentences);
    </script>
</body>
</html>